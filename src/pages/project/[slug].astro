---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import { Icon } from "astro-icon/components";
import Button from "../../components/ui/Button.astro";
import Heading from "../../components/ui/Heading.astro";

export async function getStaticPaths() {
    const projects = await getCollection("projects");

    return projects.map(project => ({
        params: { slug: project.slug },
        props: { project },
    }));
};

const { project } = Astro.props;
const { Content } = await project.render();
---

<Layout title={project.data.title}>
  <main class="bg-cream-100 text-cream-900 pt-20 pb-6">
    <!-- Hero -->
    <section class="relative h-96 lg:h-[70vh] overflow-hidden rounded-b-3xl shadow-md">
        <img 
            transition:name={`project-image-${project.slug}`}
            src={project.data.img.cover}
            alt={project.data.title}
            class="w-full h-full object-cover"
        />
        <div class="absolute inset-0 bg-gradient-to-t from-cream-100/90 via-cream-100/60 to-transparent flex items-end">
            <div class="max-w-7xl mx-auto px-6 pb-12">
                <span class="inline-flex items-center px-4 py-1 rounded-full text-sm font-medium bg-primary-200/70 text-primary-700 backdrop-blur-sm mb-4" transition:name={`project-type-${project.slug}`}>
                    {project.data.type}
                </span>
                <Heading text={project.data.title} level={1} transition:name={`project-title-${project.slug}`} />
                <p class="text-lg lg:text-xl text-cream-800 max-w-2xl">
                    {project.data.description}
                </p>
            </div>

            <!-- Botón Volver -->
            <div class="absolute top-6 left-6">
                <Button 
                    text="Volver"
                    variant="outline"
                    iconName="mdi:arrow-left"
                    iconAfterText={true}
                    link="/PortfolioArquitectoAstro/projects"
                    data-astro-prefetch
                />
            </div>
        </div>
    </section>

    <!-- Detalles -->
    <section class="max-w-7xl mx-auto px-6 py-16">
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-12">
            <!-- Contenido -->
            <div class="lg:col-span-3 space-y-12">
                <article class="prose prose-lg max-w-none text-cream-900">
                    <Content />
                </article>

                <!-- Galería -->
                {(project.data.img.secondary || project.data.img.others) && (
                    <div>
                        <h3 class="text-2xl font-bold text-cream-900 mb-6">Galería</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            {project.data.img.secondary && (
                                <div class="overflow-hidden rounded-xl shadow-md">
                                    <img 
                                        src={project.data.img.secondary} 
                                        alt={`${project.data.title} - Imagen Secundaria`} 
                                        class="w-full h-full object-cover hover:scale-105 transition-transform duration-500"
                                    />
                                </div>
                            )}
                            {project.data.img.others?.map((img, index) => (
                                <div class="overflow-hidden rounded-xl shadow-md">
                                    <img 
                                        src={img} 
                                        alt={`${project.data.title} - Imagen ${index + 1}`} 
                                        class="w-full h-full object-cover hover:scale-105 transition-transform duration-500"
                                    />
                                </div>
                            ))}
                        </div>
                    </div>
                )}
            </div>

            <!-- Sidebar -->
            <aside class="lg:col-span-1 space-y-8">
                <!-- Info -->
                <div class="bg-cream-200 rounded-2xl p-6 shadow-sm">
                    <h3 class="text-lg font-semibold mb-4 text-cram-900">Información</h3>
                    <dl class="space-y-4">
                        <div class="flex items-start">
                            <Icon name="mdi:map-marker-outline" class="w-5 h-5 text-cream-700 mt-0.5 mr-3" />
                            <div>
                                <dt class="text-sm font-medium text-cream-700">Ubicación</dt>
                                <dd class="text-cream-900">{project.data.location}</dd>
                            </div>
                        </div>
                        <div class="flex items-start">
                            <Icon name="mdi:tag-outline" class="w-5 h-5 text-cream-700 mt-0.5 mr-3" />
                            <div>
                                <dt class="text-sm font-medium text-cream-700">Tipo</dt>
                                <dd class="text-cream-900 capitalize">{project.data.type}</dd>
                            </div>
                        </div>
                        <div class="flex items-start">
                            <Icon name="mdi:calendar-outline" class="w-5 h-5 text-cream-700 mt-0.5 mr-3" />
                            <div>
                                <dt class="text-sm font-medium text-cream-700">Año</dt>
                                <dd class="text-cream-900">{project.data.date}</dd>
                            </div>
                        </div>
                    </dl>
                </div>

                <!-- Tags -->
                <div>
                    <h3 class="text-lg font-semibold text-cream-900 mb-4">Etiquetas</h3>
                    <div class="flex flex-wrap gap-2">
                        {project.data.tags.map((tag) => (
                            <span class="px-3 py-1 text-sm rounded-full bg-accent-100 text-accent-800 shadow-sm">
                                {tag}
                            </span>
                        ))}
                    </div>
                </div>

                <!-- CTA -->
                <div class="bg-primary-100 rounded-2xl p-6 shadow-md">
                    <h3 class="text-lg font-semibold text-on-primary-800 mb-2">¿Te interesa este proyecto?</h3>
                    <p class="text-on-primary-700 text-sm mb-4">Contáctanos para conocer más detalles sobre este proyecto.</p>
                    <div class="flex flex-col">
                        <Button 
                            text="Contactar"
                            variant="filled"
                            link="/PortfolioArquitectoAstro/#contacto"
                        />
                    </div>
                </div>
            </aside>
        </div>
    </section>
  </main>
</Layout>
